{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport axios from 'axios';\nexport default {\n  __name: 'ChatWithAI',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const userInput = ref('');\n    const messages = ref([]);\n    const imageFile = ref(null);\n    const imageUrl = ref('');\n\n    /** 上传图片事件 */\n    function handleImageChange(file) {\n      imageFile.value = file.raw;\n      imageUrl.value = URL.createObjectURL(file.raw);\n    }\n\n    /** 发送消息给后端 */\n    async function sendMessage() {\n      if (!userInput.value && !imageFile.value) return;\n\n      // 添加用户消息到界面\n      messages.value.push({\n        role: 'user',\n        text: userInput.value || '（仅上传图片）',\n        imageUrl: imageUrl.value || null\n      });\n      try {\n        const formData = new FormData();\n        if (userInput.value) formData.append('text', userInput.value);\n        if (imageFile.value) formData.append('image', imageFile.value);\n\n        // TODO: 改成你实际后端接收文本+图片的接口\n        const res = await axios.post('/api/ai/chat', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n\n        // 添加AI回复\n        messages.value.push({\n          role: 'assistant',\n          text: res.data.reply\n        });\n      } catch (err) {\n        messages.value.push({\n          role: 'assistant',\n          text: '请求失败: ' + err.message\n        });\n      } finally {\n        userInput.value = '';\n        imageFile.value = null;\n        imageUrl.value = '';\n      }\n    }\n    const __returned__ = {\n      userInput,\n      messages,\n      imageFile,\n      imageUrl,\n      handleImageChange,\n      sendMessage,\n      ref,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","axios","userInput","messages","imageFile","imageUrl","handleImageChange","file","value","raw","URL","createObjectURL","sendMessage","push","role","text","formData","FormData","append","res","post","headers","data","reply","err","message"],"sources":["D:/web/qianrushi/my-first-vue-app/src/views/ChatWithAI.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-container\">\r\n    <div class=\"chat-history\">\r\n      <div\r\n          v-for=\"(msg, index) in messages\"\r\n          :key=\"index\"\r\n          :class=\"['message', msg.role]\"\r\n      >\r\n        <strong>{{ msg.role === 'user' ? '我：' : 'AI：' }}</strong>\r\n        <div v-if=\"msg.text\">{{ msg.text }}</div>\r\n        <img v-if=\"msg.imageUrl\" :src=\"msg.imageUrl\" class=\"chat-image\" />\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"chat-input-area\">\r\n      <el-input\r\n          v-model=\"userInput\"\r\n          placeholder=\"请输入你的问题\"\r\n          clearable\r\n          @keyup.enter=\"sendMessage\"\r\n      />\r\n\r\n      <el-upload\r\n          class=\"upload\"\r\n          action=\"\"\r\n          :auto-upload=\"false\"\r\n          :show-file-list=\"false\"\r\n          :on-change=\"handleImageChange\"\r\n      >\r\n        <el-button type=\"primary\" plain>上传图片</el-button>\r\n      </el-upload>\r\n\r\n      <el-button type=\"success\" @click=\"sendMessage\">发送</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport axios from 'axios'\r\n\r\nconst userInput = ref('')\r\nconst messages = ref([])\r\nconst imageFile = ref(null)\r\nconst imageUrl = ref('')\r\n\r\n/** 上传图片事件 */\r\nfunction handleImageChange(file) {\r\n  imageFile.value = file.raw\r\n  imageUrl.value = URL.createObjectURL(file.raw)\r\n}\r\n\r\n/** 发送消息给后端 */\r\nasync function sendMessage() {\r\n  if (!userInput.value && !imageFile.value) return\r\n\r\n  // 添加用户消息到界面\r\n  messages.value.push({\r\n    role: 'user',\r\n    text: userInput.value || '（仅上传图片）',\r\n    imageUrl: imageUrl.value || null,\r\n  })\r\n\r\n  try {\r\n    const formData = new FormData()\r\n    if (userInput.value) formData.append('text', userInput.value)\r\n    if (imageFile.value) formData.append('image', imageFile.value)\r\n\r\n    // TODO: 改成你实际后端接收文本+图片的接口\r\n    const res = await axios.post('/api/ai/chat', formData, {\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    // 添加AI回复\r\n    messages.value.push({\r\n      role: 'assistant',\r\n      text: res.data.reply,\r\n    })\r\n  } catch (err) {\r\n    messages.value.push({\r\n      role: 'assistant',\r\n      text: '请求失败: ' + err.message,\r\n    })\r\n  } finally {\r\n    userInput.value = ''\r\n    imageFile.value = null\r\n    imageUrl.value = ''\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.chat-container {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n}\r\n.chat-history {\r\n  border: 1px solid #ccc;\r\n  border-radius: 12px;\r\n  padding: 15px;\r\n  height: 400px;\r\n  overflow-y: auto;\r\n  background: #fefefe;\r\n  margin-bottom: 20px;\r\n}\r\n.message {\r\n  margin: 10px 0;\r\n  padding: 8px 12px;\r\n  border-radius: 10px;\r\n  line-height: 1.5;\r\n  word-break: break-word;\r\n}\r\n.message.user {\r\n  background: #e1f5fe;\r\n  text-align: right;\r\n}\r\n.message.assistant {\r\n  background: #e8f5e9;\r\n  text-align: left;\r\n}\r\n.chat-image {\r\n  max-width: 200px;\r\n  max-height: 200px;\r\n  margin-top: 10px;\r\n  border-radius: 8px;\r\n}\r\n.chat-input-area {\r\n  display: flex;\r\n  gap: 10px;\r\n  align-items: center;\r\n}\r\n</style>\r\n"],"mappings":";AAsCA,SAASA,GAAG,QAAQ,KAAK;AACzB,OAAOC,KAAK,MAAM,OAAO;;;;;;;IAEzB,MAAMC,SAAS,GAAGF,GAAG,CAAC,EAAE,CAAC;IACzB,MAAMG,QAAQ,GAAGH,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMI,SAAS,GAAGJ,GAAG,CAAC,IAAI,CAAC;IAC3B,MAAMK,QAAQ,GAAGL,GAAG,CAAC,EAAE,CAAC;;IAExB;IACA,SAASM,iBAAiBA,CAACC,IAAI,EAAE;MAC/BH,SAAS,CAACI,KAAK,GAAGD,IAAI,CAACE,GAAG;MAC1BJ,QAAQ,CAACG,KAAK,GAAGE,GAAG,CAACC,eAAe,CAACJ,IAAI,CAACE,GAAG,CAAC;IAChD;;IAEA;IACA,eAAeG,WAAWA,CAAA,EAAG;MAC3B,IAAI,CAACV,SAAS,CAACM,KAAK,IAAI,CAACJ,SAAS,CAACI,KAAK,EAAE;;MAE1C;MACAL,QAAQ,CAACK,KAAK,CAACK,IAAI,CAAC;QAClBC,IAAI,EAAE,MAAM;QACZC,IAAI,EAAEb,SAAS,CAACM,KAAK,IAAI,SAAS;QAClCH,QAAQ,EAAEA,QAAQ,CAACG,KAAK,IAAI;MAC9B,CAAC,CAAC;MAEF,IAAI;QACF,MAAMQ,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;QAC/B,IAAIf,SAAS,CAACM,KAAK,EAAEQ,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEhB,SAAS,CAACM,KAAK,CAAC;QAC7D,IAAIJ,SAAS,CAACI,KAAK,EAAEQ,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAEd,SAAS,CAACI,KAAK,CAAC;;QAE9D;QACA,MAAMW,GAAG,GAAG,MAAMlB,KAAK,CAACmB,IAAI,CAAC,cAAc,EAAEJ,QAAQ,EAAE;UACrDK,OAAO,EAAE;YAAE,cAAc,EAAE;UAAsB;QACnD,CAAC,CAAC;;QAEF;QACAlB,QAAQ,CAACK,KAAK,CAACK,IAAI,CAAC;UAClBC,IAAI,EAAE,WAAW;UACjBC,IAAI,EAAEI,GAAG,CAACG,IAAI,CAACC;QACjB,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZrB,QAAQ,CAACK,KAAK,CAACK,IAAI,CAAC;UAClBC,IAAI,EAAE,WAAW;UACjBC,IAAI,EAAE,QAAQ,GAAGS,GAAG,CAACC;QACvB,CAAC,CAAC;MACJ,CAAC,SAAS;QACRvB,SAAS,CAACM,KAAK,GAAG,EAAE;QACpBJ,SAAS,CAACI,KAAK,GAAG,IAAI;QACtBH,QAAQ,CAACG,KAAK,GAAG,EAAE;MACrB;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}