{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"chat-page\"\n};\nconst _hoisted_2 = {\n  class: \"chat-box\"\n};\nconst _hoisted_3 = {\n  class: \"chat-history\"\n};\nconst _hoisted_4 = [\"src\"];\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  class: \"analysis-text\"\n};\nconst _hoisted_7 = {\n  class: \"coordinates-text\"\n};\nconst _hoisted_8 = {\n  class: \"coord-values\"\n};\nconst _hoisted_9 = {\n  class: \"image-container\"\n};\nconst _hoisted_10 = [\"src\"];\nconst _hoisted_11 = [\"src\"];\nconst _hoisted_12 = {\n  key: 1\n};\nconst _hoisted_13 = {\n  class: \"chat-inputs\"\n};\nconst _hoisted_14 = [\"disabled\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[5] || (_cache[5] = _createElementVNode(\"h2\", null, \"💬 AI 图文识别系统\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.messages, (msg, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: _normalizeClass(['msg', msg.role])\n    }, [_createElementVNode(\"p\", null, [_createElementVNode(\"strong\", null, _toDisplayString(msg.role === 'user' ? '我：' : 'AI：'), 1 /* TEXT */)]), msg.role === 'user' ? (_openBlock(), _createElementBlock(_Fragment, {\n      key: 0\n    }, [_ctx.item.type === 'text' ? (_openBlock(true), _createElementBlock(_Fragment, {\n      key: 0\n    }, _renderList(msg.content, (item, i) => {\n      return _openBlock(), _createElementBlock(\"p\", {\n        key: i\n      }, _toDisplayString(item.text), 1 /* TEXT */);\n    }), 128 /* KEYED_FRAGMENT */)) : _createCommentVNode(\"v-if\", true), _ctx.item.type === 'image_url' ? (_openBlock(true), _createElementBlock(_Fragment, {\n      key: 1\n    }, _renderList(msg.content, (item, i) => {\n      return _openBlock(), _createElementBlock(\"img\", {\n        key: 'img-' + i,\n        src: item.image_url.url,\n        class: \"chat-image\"\n      }, null, 8 /* PROPS */, _hoisted_4);\n    }), 128 /* KEYED_FRAGMENT */)) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */)) : (_openBlock(), _createElementBlock(_Fragment, {\n      key: 1\n    }, [typeof msg.content === 'object' && msg.content.analysis ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"p\", _hoisted_6, \"分析结果: \" + _toDisplayString(msg.content.analysis), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_7, [_cache[4] || (_cache[4] = _createElementVNode(\"span\", {\n      class: \"coord-label\"\n    }, \"异常坐标：\", -1 /* HOISTED */)), _createElementVNode(\"span\", _hoisted_8, \" (\" + _toDisplayString(msg.content.coordinates.x1) + \", \" + _toDisplayString(msg.content.coordinates.y1) + \") 至 (\" + _toDisplayString(msg.content.coordinates.x2) + \", \" + _toDisplayString(msg.content.coordinates.y2) + \") \", 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_9, [msg.content.original_image ? (_openBlock(), _createElementBlock(\"img\", {\n      key: 0,\n      src: msg.content.original_image,\n      alt: \"原图\",\n      class: \"chat-image\"\n    }, null, 8 /* PROPS */, _hoisted_10)) : _createCommentVNode(\"v-if\", true), msg.content.annotated_image ? (_openBlock(), _createElementBlock(\"img\", {\n      key: 1,\n      src: msg.content.annotated_image,\n      alt: \"标注图\",\n      class: \"chat-image marked\"\n    }, null, 8 /* PROPS */, _hoisted_11)) : _createCommentVNode(\"v-if\", true)])])) : (_openBlock(), _createElementBlock(\"p\", _hoisted_12, [_ctx.item.type === 'text' ? (_openBlock(true), _createElementBlock(_Fragment, {\n      key: 0\n    }, _renderList(msg.content, (item, i) => {\n      return _openBlock(), _createElementBlock(\"span\", {\n        key: i\n      }, _toDisplayString(item.text), 1 /* TEXT */);\n    }), 128 /* KEYED_FRAGMENT */)) : _createCommentVNode(\"v-if\", true)]))], 64 /* STABLE_FRAGMENT */))], 2 /* CLASS */);\n  }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_13, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.userInput = $event),\n    onKeyup: _cache[1] || (_cache[1] = _withKeys((...args) => $options.sendMessage && $options.sendMessage(...args), [\"enter\"])),\n    placeholder: \"输入内容（非必须）\",\n    class: \"chat-input\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelText, $data.userInput]]), _createElementVNode(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    onChange: _cache[2] || (_cache[2] = (...args) => $options.handleImageChange && $options.handleImageChange(...args)),\n    class: \"file-input\"\n  }, null, 32 /* NEED_HYDRATION */), _createElementVNode(\"button\", {\n    onClick: _cache[3] || (_cache[3] = (...args) => $options.sendMessage && $options.sendMessage(...args)),\n    class: \"send-btn\",\n    disabled: $data.sending\n  }, _toDisplayString($data.sending ? '发送中...' : '发送'), 9 /* TEXT, PROPS */, _hoisted_14)])]), _cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n    class: \"background-decor\"\n  }, null, -1 /* HOISTED */))]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_Fragment","_renderList","$data","messages","msg","index","_normalizeClass","role","_toDisplayString","_ctx","item","type","content","i","text","_createCommentVNode","src","image_url","url","_hoisted_4","analysis","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","coordinates","x1","y1","x2","y2","_hoisted_9","original_image","alt","_hoisted_10","annotated_image","_hoisted_11","_hoisted_12","_hoisted_13","_cache","$event","userInput","onKeyup","_withKeys","args","$options","sendMessage","placeholder","accept","onChange","handleImageChange","onClick","disabled","sending","_hoisted_14"],"sources":["D:\\web\\qianrushi\\my-first-vue-app\\src\\views\\ChatWithAI.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-page\">\r\n    <div class=\"chat-box\">\r\n      <h2>💬 AI 图文识别系统</h2>\r\n      <div class=\"chat-history\">\r\n        <div v-for=\"(msg, index) in messages\" :key=\"index\" :class=\"['msg', msg.role]\">\r\n          <p><strong>{{ msg.role === 'user' ? '我：' : 'AI：' }}</strong></p>\r\n\r\n          <template v-if=\"msg.role === 'user'\">\r\n            <p v-for=\"(item, i) in msg.content\" :key=\"i\" v-if=\"item.type === 'text'\">{{ item.text }}</p>\r\n            <img v-for=\"(item, i) in msg.content\" :key=\"'img-' + i\" v-if=\"item.type === 'image_url'\" :src=\"item.image_url.url\" class=\"chat-image\" />\r\n          </template>\r\n\r\n          <template v-else>\r\n            <div v-if=\"typeof msg.content === 'object' && msg.content.analysis\">\r\n              <p class=\"analysis-text\">分析结果: {{ msg.content.analysis }}</p>\r\n              <p class=\"coordinates-text\">\r\n                <span class=\"coord-label\">异常坐标：</span>\r\n                <span class=\"coord-values\">\r\n                  ({{ msg.content.coordinates.x1 }}, {{ msg.content.coordinates.y1 }}) 至\r\n                  ({{ msg.content.coordinates.x2 }}, {{ msg.content.coordinates.y2 }})\r\n                </span>\r\n              </p>\r\n              <div class=\"image-container\">\r\n                <img v-if=\"msg.content.original_image\" :src=\"msg.content.original_image\" alt=\"原图\" class=\"chat-image\" />\r\n                <img v-if=\"msg.content.annotated_image\" :src=\"msg.content.annotated_image\" alt=\"标注图\" class=\"chat-image marked\" />\r\n              </div>\r\n            </div>\r\n            <p v-else>\r\n              <span v-for=\"(item, i) in msg.content\" :key=\"i\" v-if=\"item.type === 'text'\">{{ item.text }}</span>\r\n            </p>\r\n          </template>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-inputs\">\r\n        <input type=\"text\" v-model=\"userInput\" @keyup.enter=\"sendMessage\" placeholder=\"输入内容（非必须）\" class=\"chat-input\" />\r\n        <input type=\"file\" accept=\"image/*\" @change=\"handleImageChange\" class=\"file-input\" />\r\n        <button @click=\"sendMessage\" class=\"send-btn\" :disabled=\"sending\">{{ sending ? '发送中...' : '发送' }}</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"background-decor\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'ChatWithAI',\r\n  data() {\r\n    return {\r\n      messages: [],\r\n      userInput: '',\r\n      imageFile: null,\r\n      sending: false\r\n    };\r\n  },\r\n  methods: {\r\n    handleImageChange(e) {\r\n      this.imageFile = e.target.files[0] || null;\r\n    },\r\n    async sendMessage() {\r\n      if (!this.imageFile && !this.userInput.trim()) {\r\n        alert('请上传图片或输入文字');\r\n        return;\r\n      }\r\n\r\n      this.sending = true;\r\n\r\n      const newMessage = {\r\n        role: 'user',\r\n        content: []\r\n      };\r\n\r\n      // 加入文本\r\n      if (this.userInput.trim()) {\r\n        newMessage.content.push({ type: 'text', text: this.userInput.trim() });\r\n      }\r\n\r\n      // 加入图片（以 base64 格式）\r\n      if (this.imageFile) {\r\n        const base64 = await this.readFileAsBase64(this.imageFile);\r\n        const mimeType = this.imageFile.type;\r\n        newMessage.content.push({\r\n          type: 'image_url',\r\n          image_url: { url: `data:${mimeType};base64,${base64}` }\r\n        });\r\n      }\r\n\r\n      this.messages.push(newMessage);\r\n\r\n      try {\r\n        const res = await fetch('/api/chat', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ messages: this.messages })\r\n        });\r\n        const data = await res.json();\r\n\r\n        if (data.success) {\r\n          this.messages = data.messages;\r\n        } else {\r\n          this.messages.push({\r\n            role: 'assistant',\r\n            content: [{ type: 'text', text: '识别失败：' + data.error }]\r\n          });\r\n        }\r\n      } catch (err) {\r\n        this.messages.push({\r\n          role: 'assistant',\r\n          content: [{ type: 'text', text: '网络错误：' + err.message }]\r\n        });\r\n      } finally {\r\n        this.userInput = '';\r\n        this.imageFile = null;\r\n        this.sending = false;\r\n      }\r\n    },\r\n    readFileAsBase64(file) {\r\n      return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = e => {\r\n          const base64 = e.target.result.split(',')[1];\r\n          resolve(base64);\r\n        };\r\n        reader.onerror = reject;\r\n        reader.readAsDataURL(file);\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.chat-page {\r\n  position: absolute;\r\n  top: 60px;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: linear-gradient(to right, #1c1c1c, #2a2a2a);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 40px 20px;\r\n  overflow: auto;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.chat-box {\r\n  background: rgba(0, 0, 0, 0.3);\r\n  border: 1px solid #00eaff55;\r\n  border-radius: 12px;\r\n  box-shadow: 0 0 20px rgba(0, 234, 255, 0.1);\r\n  padding: 30px;\r\n  max-width: 700px;\r\n  width: 100%;\r\n}\r\n\r\n.chat-box h2 {\r\n  font-size: 24px;\r\n  color: #00eaff;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.chat-history {\r\n  max-height: 400px;\r\n  overflow-y: auto;\r\n  padding-right: 8px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.msg {\r\n  margin-bottom: 16px;\r\n  color: #e0f7ff;\r\n}\r\n\r\n.msg.user {\r\n  text-align: right;\r\n  color: #bbdefb;\r\n}\r\n\r\n.msg.assistant {\r\n  text-align: left;\r\n  color: #c8e6c9;\r\n}\r\n\r\n.chat-image {\r\n  max-width: 200px;\r\n  margin-top: 10px;\r\n  border-radius: 8px;\r\n  display: block;\r\n}\r\n\r\n.chat-inputs {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 10px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.chat-input {\r\n  flex: 1;\r\n  padding: 10px;\r\n  border: 1px solid #00eaff55;\r\n  border-radius: 8px;\r\n  background: #222;\r\n  color: #fff;\r\n  outline: none;\r\n}\r\n\r\n.file-input {\r\n  color: #fff;\r\n}\r\n\r\n.send-btn {\r\n  padding: 10px 20px;\r\n  background: #00eaff;\r\n  border: none;\r\n  border-radius: 8px;\r\n  color: #000;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  transition: background 0.3s;\r\n}\r\n.send-btn:hover {\r\n  background: #00bcd4;\r\n}\r\n\r\n.background-decor {\r\n  position: absolute;\r\n  bottom: -100px;\r\n  left: -150px;\r\n  width: 400px;\r\n  height: 400px;\r\n  background: radial-gradient(circle at center, rgba(0, 234, 255, 0.2), transparent);\r\n  filter: blur(120px);\r\n  pointer-events: none;\r\n}\r\n</style>\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAW;;EACfA,KAAK,EAAC;AAAU;;EAEdA,KAAK,EAAC;AAAc;mBAJ/B;;EAAAC,GAAA;AAAA;;EAeiBD,KAAK,EAAC;AAAe;;EACrBA,KAAK,EAAC;AAAkB;;EAEnBA,KAAK,EAAC;AAAc;;EAKvBA,KAAK,EAAC;AAAiB;oBAvB1C;oBAAA;;EAAAC,GAAA;AAAA;;EAmCWD,KAAK,EAAC;AAAa;oBAnC9B;;uBACEE,mBAAA,CAyCM,OAzCNC,UAyCM,GAxCJC,mBAAA,CAsCM,OAtCNC,UAsCM,G,0BArCJD,mBAAA,CAAqB,YAAjB,cAAY,sBAChBA,mBAAA,CA6BM,OA7BNE,UA6BM,I,kBA5BJJ,mBAAA,CA2BMK,SAAA,QAhCdC,WAAA,CAKoCC,KAAA,CAAAC,QAAQ,EAL5C,CAKqBC,GAAG,EAAEC,KAAK;yBAAvBV,mBAAA,CA2BM;MA3BiCD,GAAG,EAAEW,KAAK;MAAGZ,KAAK,EALjEa,eAAA,SAK2EF,GAAG,CAACG,IAAI;QACzEV,mBAAA,CAAgE,YAA7DA,mBAAA,CAAyD,gBAAAW,gBAAA,CAA9CJ,GAAG,CAACG,IAAI,2C,GAENH,GAAG,CAACG,IAAI,e,cAAxBZ,mBAAA,CAGWK,SAAA;MAXrBN,GAAA;IAAA,IAS+De,IAAA,CAAAC,IAAI,CAACC,IAAI,e,kBAA5DhB,mBAAA,CAA4FK,SAAA;MATxGN,GAAA;IAAA,GAAAO,WAAA,CASmCG,GAAG,CAACQ,OAAO,EAT9C,CASuBF,IAAI,EAAEG,CAAC;2BAAlBlB,mBAAA,CAA4F;QAAvDD,GAAG,EAAEmB;MAAC,GAAAL,gBAAA,CAAiCE,IAAI,CAACI,IAAI;qCATjGC,mBAAA,gBAU0EN,IAAA,CAAAC,IAAI,CAACC,IAAI,oB,kBAAvEhB,mBAAA,CAAwIK,SAAA;MAVpJN,GAAA;IAAA,GAAAO,WAAA,CAUqCG,GAAG,CAACQ,OAAO,EAVhD,CAUyBF,IAAI,EAAEG,CAAC;2BAApBlB,mBAAA,CAAwI;QAAjGD,GAAG,WAAWmB,CAAC;QAAoCG,GAAG,EAAEN,IAAI,CAACO,SAAS,CAACC,GAAG;QAAEzB,KAAK,EAAC;8BAVrI0B,UAAA;qCAAAJ,mBAAA,e,8CAaUpB,mBAAA,CAkBWK,SAAA;MA/BrBN,GAAA;IAAA,I,OAc8BU,GAAG,CAACQ,OAAO,iBAAiBR,GAAG,CAACQ,OAAO,CAACQ,QAAQ,I,cAAlEzB,mBAAA,CAaM,OA3BlB0B,UAAA,GAecxB,mBAAA,CAA6D,KAA7DyB,UAA6D,EAApC,QAAM,GAAAd,gBAAA,CAAGJ,GAAG,CAACQ,OAAO,CAACQ,QAAQ,kBACtDvB,mBAAA,CAMI,KANJ0B,UAMI,G,0BALF1B,mBAAA,CAAsC;MAAhCJ,KAAK,EAAC;IAAa,GAAC,OAAK,sBAC/BI,mBAAA,CAGO,QAHP2B,UAGO,EAHoB,IACxB,GAAAhB,gBAAA,CAAGJ,GAAG,CAACQ,OAAO,CAACa,WAAW,CAACC,EAAE,IAAG,IAAE,GAAAlB,gBAAA,CAAGJ,GAAG,CAACQ,OAAO,CAACa,WAAW,CAACE,EAAE,IAAG,OAClE,GAAAnB,gBAAA,CAAGJ,GAAG,CAACQ,OAAO,CAACa,WAAW,CAACG,EAAE,IAAG,IAAE,GAAApB,gBAAA,CAAGJ,GAAG,CAACQ,OAAO,CAACa,WAAW,CAACI,EAAE,IAAG,IACrE,gB,GAEFhC,mBAAA,CAGM,OAHNiC,UAGM,GAFO1B,GAAG,CAACQ,OAAO,CAACmB,cAAc,I,cAArCpC,mBAAA,CAAuG;MAxBvHD,GAAA;MAwBwDsB,GAAG,EAAEZ,GAAG,CAACQ,OAAO,CAACmB,cAAc;MAAEC,GAAG,EAAC,IAAI;MAACvC,KAAK,EAAC;4BAxBxGwC,WAAA,KAAAlB,mBAAA,gBAyB2BX,GAAG,CAACQ,OAAO,CAACsB,eAAe,I,cAAtCvC,mBAAA,CAAiH;MAzBjID,GAAA;MAyByDsB,GAAG,EAAEZ,GAAG,CAACQ,OAAO,CAACsB,eAAe;MAAEF,GAAG,EAAC,KAAK;MAACvC,KAAK,EAAC;4BAzB3G0C,WAAA,KAAApB,mBAAA,e,sBA4BYpB,mBAAA,CAEI,KA9BhByC,WAAA,GA6BoE3B,IAAA,CAAAC,IAAI,CAACC,IAAI,e,kBAA/DhB,mBAAA,CAAkGK,SAAA;MA7BhHN,GAAA;IAAA,GAAAO,WAAA,CA6BwCG,GAAG,CAACQ,OAAO,EA7BnD,CA6B4BF,IAAI,EAAEG,CAAC;2BAArBlB,mBAAA,CAAkG;QAA1DD,GAAG,EAAEmB;MAAC,GAAAL,gBAAA,CAAiCE,IAAI,CAACI,IAAI;qCA7BtGC,mBAAA,e;oCAmCMlB,mBAAA,CAIM,OAJNwC,WAIM,G,gBAHJxC,mBAAA,CAA+G;IAAxGc,IAAI,EAAC,MAAM;IApC1B,uBAAA2B,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAoCoCrC,KAAA,CAAAsC,SAAS,GAAAD,MAAA;IAAGE,OAAK,EAAAH,MAAA,QAAAA,MAAA,MApCrDI,SAAA,KAAAC,IAAA,KAoC6DC,QAAA,CAAAC,WAAA,IAAAD,QAAA,CAAAC,WAAA,IAAAF,IAAA,CAAW;IAAEG,WAAW,EAAC,WAAW;IAACrD,KAAK,EAAC;iEAApES,KAAA,CAAAsC,SAAS,E,GACrC3C,mBAAA,CAAqF;IAA9Ec,IAAI,EAAC,MAAM;IAACoC,MAAM,EAAC,SAAS;IAAEC,QAAM,EAAAV,MAAA,QAAAA,MAAA,UAAAK,IAAA,KAAEC,QAAA,CAAAK,iBAAA,IAAAL,QAAA,CAAAK,iBAAA,IAAAN,IAAA,CAAiB;IAAElD,KAAK,EAAC;qCACtEI,mBAAA,CAA0G;IAAjGqD,OAAK,EAAAZ,MAAA,QAAAA,MAAA,UAAAK,IAAA,KAAEC,QAAA,CAAAC,WAAA,IAAAD,QAAA,CAAAC,WAAA,IAAAF,IAAA,CAAW;IAAElD,KAAK,EAAC,UAAU;IAAE0D,QAAQ,EAAEjD,KAAA,CAAAkD;sBAAYlD,KAAA,CAAAkD,OAAO,0CAtCpFC,WAAA,E,+BAyCIxD,mBAAA,CAAoC;IAA/BJ,KAAK,EAAC;EAAkB,4B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}